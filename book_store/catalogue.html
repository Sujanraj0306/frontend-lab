<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Catalogue - BookHaven</title>
  <style>
    body { margin:0; font-family:sans-serif; background:white; }
    .stepper-container { display: flex; flex-direction: column; align-items: center; }
    .quantity-stepper { display: flex; align-items: center; justify-content: center; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; }
    .quantity-btn { background: #f0f0f0; border: none; font-size: 18px; font-weight: bold; cursor: pointer; padding: 8px 14px; color: #333; }
    .quantity-btn:disabled { color: #ccc; cursor: not-allowed; background: #f9f9f9; }
    .quantity-value { padding: 0 18px; font-size: 16px; font-weight: bold; }
    .stock-alert { font-size: 12px; color: #d9534f; text-align: center; margin-top: 5px; height: 14px; }
    .book-card { cursor: pointer; }
    #sidebar-links a.active { background-color: #e0e0e0; font-weight: bold;}
  </style>
</head>
<body>

<nav style="position:fixed; top:0; width:100%; box-sizing: border-box; background-color:white; padding:20px 40px; box-shadow:0 2px 10px rgba(0,0,0,0.05); z-index:999;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div style="display:flex; align-items:center; gap:10px;">
      <div style="padding:1px; border-radius:10px;">
        <span style="color:white; font-size:40px;">
          <img src="data:image/png;base64,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" height="40px" width="40px">
        </span>
      </div>
      <div>
        <h1 style="margin:0; font-size:24px;">BookHaven</h1>
        <p style="margin:0; font-size:14px; color:gray;">Premium Collection</p>
      </div>
    </div>
    <div style="display:flex; gap:40px; align-items:center;">
      <a href="home.html" style="text-decoration:none; color:black; font-weight:500;">Home</a>
      <a href="catalogue.html" style="text-decoration:none; color:black; font-weight:500;">Catalogue</a>
      <a href="cart.html" style="position:relative; text-decoration:none; color:black; font-weight:500;">
        Cart
        <span id="cartCount" style="position:absolute; top:-10px; right:-15px; background:red; color:white; border-radius:50%; padding: 2px 6px; font-size:12px; font-weight:bold;">0</span>
      </a>
      <a href="login.html" style="text-decoration:none; color:black; font-weight:500;">Login</a>
      <a href="register.html" style="padding:10px 20px; background:black; color:white; border-radius:8px; text-decoration:none; font-weight:500;">Register</a>
    </div>
  </div>
</nav>

<div style="display:flex; padding-top:100px;">

  <aside style="position:fixed; top:100px; left:0; width:220px; height:calc(100vh - 100px); padding:30px 20px; background:#f9f9f9; border-right:1px solid #ddd; overflow-y:auto;">
    <h3 style="margin-bottom:20px; font-size:18px; color:black;">Categories</h3>
    <ul id="sidebar-links" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:15px;">
      <li><a href="#All" style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:white; color:black; text-decoration:none; font-size:14px; font-weight:500; transition:all 0.3s;" onmouseover="this.style.background='#eaeaea'" onmouseout="this.style.background='white'"><span>All Books</span> <span>➔</span></a></li>
      <li><a href="#Computer Science" style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:white; color:black; text-decoration:none; font-size:14px; font-weight:500; transition:all 0.3s;" onmouseover="this.style.background='#eaeaea'" onmouseout="this.style.background='white'"><span>Computer Science</span> <span>➔</span></a></li>
      <li><a href="#Electronics" style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:white; color:black; text-decoration:none; font-size:14px; font-weight:500; transition:all 0.3s;" onmouseover="this.style.background='#eaeaea'" onmouseout="this.style.background='white'"><span>Electronics</span> <span>➔</span></a></li>
      <li><a href="#Electrical" style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:white; color:black; text-decoration:none; font-size:14px; font-weight:500; transition:all 0.3s;" onmouseover="this.style.background='#eaeaea'" onmouseout="this.style.background='white'"><span>Electrical</span> <span>➔</span></a></li>
      <li><a href="#Civil Engineering" style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:white; color:black; text-decoration:none; font-size:14px; font-weight:500; transition:all 0.3s;" onmouseover="this.style.background='#eaeaea'" onmouseout="this.style.background='white'"><span>Civil Engineering</span> <span>➔</span></a></li>
    </ul>
  </aside>

  <main style="flex:1; padding:30px 40px; margin-left: 220px;">
    
    <div style="margin-bottom:40px;">
      <h1 id="catalogue-title" style="font-size:32px; font-weight:bold; color:black; margin-bottom:5px;">All Books</h1>
      <p style="font-size:16px; color:gray;">Explore our curated collection of academic resources</p>
    </div>

    <div style="background:#f9f9f9; border:1px solid #e5e7eb; border-radius:16px; padding:20px; margin-bottom: 40px; box-shadow:0 2px 10px rgba(0,0,0,0.03);">
      <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
        
        <div style="position:relative; flex: 2 1 300px; min-width: 250px;">
          <input id="searchBox" type="text" placeholder="Search books or authors..." style="padding:12px 16px 12px 44px; border:1px solid #ccc; border-radius:12px; width:100%; font-size:15px; background:white; box-sizing: border-box;" />
          <span style="position:absolute; top:50%; left:14px; transform:translateY(-50%); color:#aaa;">
            <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
          </span>
        </div>
        
        <div style="display:none;">
          <select id="categoryFilter">
            <option>All</option>
            <option>Computer Science</option>
            <option>Electronics</option>
            <option>Electrical</option>
            <option>Civil Engineering</option>
          </select>
        </div>
        
        <div style="flex: 1 1 200px; min-width: 200px;">
          <select id="sortFilter" style="padding:12px 16px; border:1px solid #ccc; border-radius:12px; width:100%; font-size:15px; background:white; box-sizing: border-box;">
            <option value="title">Sort by Title</option>
            <option value="priceLow">Price: Low to High</option>
            <option value="priceHigh">Price: High to Low</option>
            <option value="rating">Highest Rated</option>
          </select>
        </div>
      </div>
    </div>

    <div id="booksGrid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:30px;">
      </div>
  </main>
</div>

<script>
  // --- STATE MANAGEMENT ---
  // **FIX**: Added 5 new books to the collection
  const books = [
    { title: "Advanced Algorithms", author: "Dr. Sarah Chen", category: "Computer Science", price: 89.99, rating: 4.9, quantity: 5, image: "https://images.pexels.com/photos/159711/books-bookstore-book-reading-159711.jpeg" },
    { title: "Digital Signal Processing", author: "Prof. Michael Rodriguez", category: "Electronics", price: 94.99, rating: 4.8, quantity: 0, image: "https://images.pexels.com/photos/1029141/pexels-photo-1029141.jpeg" },
    { title: "Power Systems Analysis", author: "Dr. Emily Johnson", category: "Electrical", price: 76.99, rating: 4.7, quantity: 12, image: "https://media.springernature.com/full/springer-static/cover-hires/book/978-981-15-3212-2" },
    { title: "Advanced Civil Engineering", author: "Dr. Sarah Chen", category: "Civil Engineering", price: 89.99, rating: 4.9, quantity: 1, image: "https://m.media-amazon.com/images/I/61CRdeBnfqL._UF1000,1000_QL80_.jpg" },
    { title: "Digital Signal Processing 2", author: "Prof. Michael Rodriguez", category: "Electronics", price: 94.99, rating: 4.8, quantity: 8, image: "https://media.springernature.com/full/springer-static/cover-hires/book/978-3-030-96322-4" },
    { title: "Power Systems Analysis 2", author: "Dr. Emily Johnson", category: "Electrical", price: 76.99, rating: 4.7, quantity: 0, image: "https://media.springernature.com/full/springer-static/cover-hires/book/978-981-15-3212-2" },
    { title: "The Art of Computer Programming", author: "Donald Knuth", category: "Computer Science", price: 120.50, rating: 5.0, quantity: 3, image: "https://images.pexels.com/photos/2041540/pexels-photo-2041540.jpeg" },
    { title: "Structural Engineering Handbook", author: "Dr. John Davis", category: "Civil Engineering", price: 110.00, rating: 4.8, quantity: 6, image: "https://images.pexels.com/photos/1106468/pexels-photo-1106468.jpeg" },
    { title: "Introduction to Machine Learning", author: "Dr. Ava Wong", category: "Computer Science", price: 99.50, rating: 4.9, quantity: 10, image: "https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg" },
    { title: "Circuit Design and Simulation", author: "Prof. Ian Miller", category: "Electronics", price: 85.00, rating: 4.7, quantity: 7, image: "https://images.pexels.com/photos/416405/pexels-photo-416405.jpeg" },
    { title: "Renewable Energy Systems", author: "Dr. Maria Garcia", category: "Electrical", price: 115.75, rating: 4.9, quantity: 9, image: "https://images.pexels.com/photos/414837/pexels-photo-414837.jpeg" },
    { title: "Python for Data Analysis", author: "Dr. David Lee", category: "Computer Science", price: 79.99, rating: 4.8, quantity: 15, image: "https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg" }
  ];
  let cart = JSON.parse(localStorage.getItem('bookCart')) || [];

  function saveCart() { localStorage.setItem('bookCart', JSON.stringify(cart)); }
  function handleAddToCart(bookTitle) {
      const book = books.find(b => b.title === bookTitle);
      if (book && book.quantity > 0) { cart.push({ book, quantity: 1 }); rerenderPage(); }
  }
  function handleIncreaseQuantity(bookTitle) {
      const cartItem = cart.find(item => item.book.title === bookTitle);
      if (cartItem && cartItem.quantity < cartItem.book.quantity) { cartItem.quantity++; rerenderPage(); }
  }
  function handleDecreaseQuantity(bookTitle) {
      const cartItemIndex = cart.findIndex(item => item.book.title === bookTitle);
      if (cartItemIndex > -1) {
          cart[cartItemIndex].quantity--;
          if (cart[cartItemIndex].quantity === 0) { cart.splice(cartItemIndex, 1); }
          rerenderPage();
      }
  }
  function updateCartInfo() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = totalItems;
  }
  function rerenderPage() { saveCart(); updateCartInfo(); filterBooks(); }
  function getStarRating(rating) { return '⭐'.repeat(Math.round(rating)); }

  function renderBooks(bookList) {
    const grid = document.getElementById('booksGrid');
    if (bookList.length === 0) {
        grid.innerHTML = `<p style="text-align:center; color:gray; grid-column: 1 / -1; font-size: 18px;">No books match your criteria.</p>`; return;
    }
    grid.innerHTML = bookList.map(book => {
      const cartItem = cart.find(item => item.book.title === book.title);
      const isInCart = !!cartItem;
      let buttonHtml, stockMessage = '';
      if (isInCart) {
          const currentQty = cartItem.quantity;
          const maxQtyReached = currentQty >= book.quantity;
          if (maxQtyReached) { stockMessage = `Only ${book.quantity} left!`; }
          buttonHtml = `<div class="stepper-container"><div class="quantity-stepper"><button class="quantity-btn minus-btn" data-title="${book.title}">-</button><span class="quantity-value">${currentQty}</span><button class="quantity-btn plus-btn" data-title="${book.title}" ${maxQtyReached ? 'disabled' : ''}>+</button></div><div class="stock-alert">${stockMessage}</div></div>`;
      } else {
          const isOutOfStock = book.quantity === 0;
          buttonHtml = `<div class="stepper-container"><button class="addToCartBtn" data-title="${book.title}" style="background:${isOutOfStock ? '#ccc' : 'black'}; color:${isOutOfStock ? '#666' : 'white'}; padding:10px 16px; border-radius:8px; border:none; cursor:${isOutOfStock ? 'not-allowed' : 'pointer'};" ${isOutOfStock ? 'disabled' : ''}>${isOutOfStock ? "Out of Stock" : "Add to Cart"}</button><div class="stock-alert"></div></div>`;
      }
      return `<div class="book-card"><div style="background:white; border:1px solid #ddd; border-radius:20px; overflow:hidden; transition:transform 0.3s, box-shadow 0.3s; display:flex; flex-direction:column; height:100%;" onmouseover="this.style.transform='translateY(-10px)'; this.style.boxShadow='0 10px 20px rgba(0,0,0,0.1)'" onmouseout="this.style.transform=''; this.style.boxShadow=''"><div class="card-content-wrapper" data-title="${encodeURIComponent(book.title)}" data-author="${encodeURIComponent(book.author)}" data-category="${encodeURIComponent(book.category)}" data-price="${book.price}" data-rating="${book.rating}" data-quantity="${book.quantity}" data-image="${encodeURIComponent(book.image)}"><img src="${book.image}" alt="${book.title}" style="width:100%; height:320px; object-fit:cover;"><div style="padding:20px; display:flex; flex-direction:column; flex-grow:1;"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span style="background:black; color:white; padding:5px 12px; border-radius:20px; font-size:12px;">${book.category}</span><div style="color:black; font-size:14px;" title="Rating: ${book.rating}">${getStarRating(book.rating)}</div></div><h3 style="font-weight:bold; font-size:20px; color:black; flex-grow:1;">${book.title}</h3><p style="color:gray; margin-top:5px; min-height:40px;">${book.author}</p></div></div><div style="padding:0 20px 20px 20px; display:flex; justify-content:space-between; align-items:center; margin-top:auto;"><span style="font-size:22px; font-weight:bold; color:black;">$${book.price}</span>${buttonHtml}</div></div></div>`;
    }).join('');
  }

  function filterBooks() {
    let filtered = [...books];
    const search = document.getElementById('searchBox').value.toLowerCase();
    const category = document.getElementById('categoryFilter').value;
    const sort = document.getElementById('sortFilter').value;
    
    if (search) { filtered = filtered.filter(b => b.title.toLowerCase().includes(search) || b.author.toLowerCase().includes(search)); }
    if (category && category !== "All") { filtered = filtered.filter(b => b.category === category); }
    if (sort === 'priceLow') { filtered.sort((a, b) => a.price - b.price); } 
    else if (sort === 'priceHigh') { filtered.sort((a, b) => b.price - a.price); } 
    else if (sort === 'rating') { filtered.sort((a, b) => b.rating - a.rating); } 
    else { filtered.sort((a, b) => a.title.localeCompare(b.title)); }
    renderBooks(filtered);
  }

  document.addEventListener('DOMContentLoaded', () => {
    rerenderPage();
    document.getElementById('searchBox').addEventListener('input', filterBooks);
    document.getElementById('sortFilter').addEventListener('change', filterBooks);
    
    document.getElementById('booksGrid').addEventListener('click', function(e) {
      const target = e.target;
      const bookTitle = target.dataset.title;
      if (target.closest('.addToCartBtn')) { handleAddToCart(bookTitle); } 
      else if (target.closest('.plus-btn')) { handleIncreaseQuantity(bookTitle); } 
      else if (target.closest('.minus-btn')) { handleDecreaseQuantity(bookTitle); } 
      else if (target.closest('.card-content-wrapper')) {
        const cardData = target.closest('.card-content-wrapper').dataset;
        window.location.href = `book.html?title=${cardData.title}&author=${cardData.author}&category=${cardData.category}&price=${cardData.price}&rating=${cardData.rating}&quantity=${cardData.quantity}&image=${cardData.image}`;
      }
    });

    document.getElementById('sidebar-links').addEventListener('click', (e) => {
        e.preventDefault();
        const link = e.target.closest('a');
        if (link) {
            document.querySelectorAll('#sidebar-links a').forEach(a => a.style.backgroundColor = 'white');
            link.style.backgroundColor = '#eaeaea';
            
            const category = link.getAttribute('href').substring(1);
            document.getElementById('categoryFilter').value = category;
            document.getElementById('catalogue-title').textContent = category;
            filterBooks();
        }
    });
  });
</script>

</body>
</html>