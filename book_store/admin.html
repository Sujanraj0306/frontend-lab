<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - BookHaven</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
        nav { position: fixed; top: 0; width: 96%; background: white; padding: 20px 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000; }
        .container { padding: 100px 40px 40px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: middle; }
        th { background-color: #f2f2f2; }
        .actions button { padding: 6px 12px; margin-right: 5px; cursor: pointer; border-radius: 4px; border: 1px solid #ccc; }
        .add-book-form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-top: 20px; }
        .add-book-form input { width: 95%; padding: 10px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
        .add-book-form button { background: black; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        /* Styles for input fields inside the table during edit mode */
        td input { width: 90%; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

    <nav>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="display:flex; align-items:center; gap:10px;">
          <div>
            <h1 style="margin:0; font-size:24px;">BookHaven</h1>
            <p style="margin:0; font-size:14px; color:gray;">Admin Dashboard</p>
          </div>
        </div>
        <div>
          <a href="login.html" style="padding:10px 20px; background:black; color:white; border-radius:8px; text-decoration:none; font-weight:500;">Logout</a>
        </div>
      </div>
    </nav>

    <div class="container">
        <h2>Book Management</h2>

        <div class="add-book-form">
            <h3>Add New Book</h3>
            <form id="add-book-form">
                <input type="text" id="title" placeholder="Title" required>
                <input type="text" id="author" placeholder="Author" required>
                <input type="text" id="category" placeholder="Category" required>
                <input type="number" id="price" placeholder="Price" step="0.01" required>
                <input type="number" id="rating" placeholder="Rating (0-5)" step="0.1" min="0" max="5" required>
                <input type="number" id="quantity" placeholder="Quantity" required>
                <input type="text" id="image" placeholder="Image URL" required>
                <button type="submit">Add Book</button>
            </form>
        </div>

        <h2>Book Inventory</h2>
        <table id="book-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Category</th>
                    <th>Price ($)</th>
                    <th>Rating</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="book-list">
                </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const bookList = document.getElementById('book-list');
            const addBookForm = document.getElementById('add-book-form');
            let books = [];
            let editIndex = -1; // -1 means no row is currently being edited

            // --- DATA HANDLING ---

            // Fetch books from JSON file
            function getBooks() {
                fetch('books.json')
                    .then(response => response.json())
                    .then(data => {
                        books = data;
                        renderBooks();
                    })
                    .catch(error => console.error('Error fetching books:', error));
            }

            // Render the entire table based on the books array and editIndex
            function renderBooks() {
                bookList.innerHTML = '';
                books.forEach((book, index) => {
                    const row = document.createElement('tr');
                    
                    if (index === editIndex) {
                        // Render EDITABLE row with input fields
                        row.innerHTML = `
                            <td><input type="text" id="edit-title" value="${book.title}"></td>
                            <td><input type="text" id="edit-author" value="${book.author}"></td>
                            <td><input type="text" id="edit-category" value="${book.category}"></td>
                            <td><input type="number" id="edit-price" value="${book.price.toFixed(2)}" step="0.01"></td>
                            <td><input type="number" id="edit-rating" value="${book.rating}" step="0.1" min="0" max="5"></td>
                            <td><input type="number" id="edit-quantity" value="${book.quantity}"></td>
                            <td class="actions">
                                <button onclick="saveBook(${index})">Save</button>
                                <button onclick="cancelEdit()">Cancel</button>
                            </td>
                        `;
                    } else {
                        // Render NORMAL display row
                        row.innerHTML = `
                            <td>${book.title}</td>
                            <td>${book.author}</td>
                            <td>${book.category}</td>
                            <td>${book.price.toFixed(2)}</td>
                            <td>${book.rating}</td>
                            <td>${book.quantity}</td>
                            <td class="actions">
                                <button onclick="toggleEditMode(${index})">Edit</button>
                                <button onclick="deleteBook(${index})">Delete</button>
                            </td>
                        `;
                    }
                    bookList.appendChild(row);
                });
            }

            // --- CRUD FUNCTIONS (exposed to window for onclick) ---

            // CREATE: Add a new book from the top form
            addBookForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const newBook = {
                    title: document.getElementById('title').value,
                    author: document.getElementById('author').value,
                    category: document.getElementById('category').value,
                    price: parseFloat(document.getElementById('price').value),
                    rating: parseFloat(document.getElementById('rating').value),
                    quantity: parseInt(document.getElementById('quantity').value),
                    image: document.getElementById('image').value,
                };
                books.push(newBook);
                cancelEdit(); // Ensure we are not in edit mode
                renderBooks();
                addBookForm.reset();
                alert('Book added successfully!');
            });

            // UPDATE Part 1: Toggle a row into edit mode
            window.toggleEditMode = function(index) {
                editIndex = index;
                renderBooks();
            };
            
            // UPDATE Part 2: Cancel the edit and revert to display mode
            window.cancelEdit = function() {
                editIndex = -1;
                renderBooks();
            };

            // UPDATE Part 3: Save the updated book data
            window.saveBook = function(index) {
                const updatedBook = {
                    ...books[index], // Preserve original data like image URL
                    title: document.getElementById('edit-title').value,
                    author: document.getElementById('edit-author').value,
                    category: document.getElementById('edit-category').value,
                    price: parseFloat(document.getElementById('edit-price').value),
                    rating: parseFloat(document.getElementById('edit-rating').value),
                    quantity: parseInt(document.getElementById('edit-quantity').value)
                };

                // Simple validation
                if (!updatedBook.title || !updatedBook.author || isNaN(updatedBook.price) || isNaN(updatedBook.quantity)) {
                    alert('Please fill all fields correctly.');
                    return;
                }

                books[index] = updatedBook;
                cancelEdit(); // Exit edit mode and re-render
                alert('Book updated successfully!');
            };

            // DELETE: Remove a book from the array
            window.deleteBook = function(index) {
                if (confirm(`Are you sure you want to delete "${books[index].title}"?`)) {
                    books.splice(index, 1);
                    cancelEdit(); // Ensure we are not in edit mode
                    renderBooks();
                    alert('Book deleted successfully!');
                }
            };

            // Initial load of books
            getBooks();
        });
    </script>

</body>
</html>